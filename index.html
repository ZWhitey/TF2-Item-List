<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>My first BootstrapVue app</title>
    <!-- Required Stylesheets -->
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />

    <!-- Load polyfills to support older browsers -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <!-- Our application root element -->
    <div id="nav">
        <b-navbar toggleable="lg" type="dark" variant="dark">
            <b-navbar-brand href="#">TF2 Items</b-navbar-brand>

            <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

            <b-collapse id="nav-collapse" is-nav>
                <b-navbar-nav>
                    <b-nav-item href="#">Link</b-nav-item>
                    <b-nav-item href="#" disabled>Disabled</b-nav-item>
                </b-navbar-nav>

            </b-collapse>
        </b-navbar>
    </div>
    <div id="app">
        <b-container>
            <b-jumbotron header="TF2 Item Data" lead="Bootstrap v4 Components for Vue.js 2">
            </b-jumbotron>
            <b-row>
                <b-form-group label="Using options array:">
                    <b-form-checkbox-group id="checkbox-group-1" v-model="selected" :options="f_class" name="flavour-1">
                    </b-form-checkbox-group>
                </b-form-group>

            </b-row>
            <b-row>
                <b-pagination v-model="currentPage" :total-rows="rows" :per-page="perPage" aria-controls="item-table"
                    first-number last-number>
                </b-pagination>
            </b-row>
            <b-row>
                <b-col>
                    <b-table id="item-table" striped hover :items="itemProvider" :per-page="perPage"
                        :current-page="currentPage"></b-table>
                </b-col>

            </b-row>
            <b-row>
                <b-pagination v-model="currentPage" :total-rows="rows" :per-page="perPage" aria-controls="item-table"
                    first-number last-number>
                </b-pagination>
            </b-row>

        </b-container>
    </div>

    <!-- Start running your app -->
    <script>
        new Vue({
            el: '#nav'
        })
        window.app = new Vue({
            el: '#app',
            data() {
                return {
                    name: '',
                    f_class: [1, 2, 3, 4, 5, 6, 7, 8, 9],
                    perPage: 50,
                    currentPage: 1,
                    en:[]
                }
            },
            computed: {
                rows() {
                    return this.en.length
                }
            },
            created: function () {
                this.loadData();
            },
            methods: {
                loadData: function () {
                    var vm = this;
                    $.when($.getJSON("./item_data/en_1.json"),
                        $.getJSON("./item_data/en_2.json"),
                        $.getJSON("./item_data/en_3.json"),
                        $.getJSON("./item_data/en_4.json"),
                        $.getJSON("./item_data/en_5.json"),
                        $.getJSON("./item_data/en_6.json"),
                        $.getJSON("./item_data/en_7.json"),
                        $.getJSON(`./item_data/zh-TW_1.json`),
                        $.getJSON(`./item_data/zh-TW_2.json`),
                        $.getJSON(`./item_data/zh-TW_3.json`),
                        $.getJSON(`./item_data/zh-TW_4.json`),
                        $.getJSON(`./item_data/zh-TW_5.json`),
                        $.getJSON(`./item_data/zh-TW_6.json`),
                        $.getJSON(`./item_data/zh-TW_7.json`),
                        $.getJSON(`./item_data/en_schema.json`),
                        $.getJSON(`./item_data/zh-tw_schema.json`)
                    ).done(function (en1, en2, en3, en4, en5, en6, en7, tw1, tw2, tw3, tw4, tw5, tw6, tw7, ens, tws) {
                        tw = tw1[0]['result']['items'];
                        tw = tw.concat(tw2[0]['result']['items']);
                        tw = tw.concat(tw3[0]['result']['items']);
                        tw = tw.concat(tw4[0]['result']['items']);
                        tw = tw.concat(tw5[0]['result']['items']);
                        tw = tw.concat(tw6[0]['result']['items']);
                        tw = tw.concat(tw7[0]['result']['items']);
                        en = en1[0]['result']['items'];
                        en = en.concat(en2[0]['result']['items']);
                        en = en.concat(en3[0]['result']['items']);
                        en = en.concat(en4[0]['result']['items']);
                        en = en.concat(en5[0]['result']['items']);
                        en = en.concat(en6[0]['result']['items']);
                        en = en.concat(en7[0]['result']['items']);
                        en_unusual = ens[0]['result']['attribute_controlled_attached_particles'];
                        tw_unusual = tws[0]['result']['attribute_controlled_attached_particles'];
                        vm.tw = tw;
                        vm.en = en;
                        vm.$root.$emit('bv::refresh::table', 'item-table')
                    });
                },
                itemProvider: function (ctx) {
                    let items = [];
                    let start = (ctx.currentPage - 1) * ctx.perPage;
                    for (let i = start; i < start + ctx.perPage; ++i) {
                        items.push({
                            Index: this.en[i].defindex,
                            Item_Name: this.en[i].item_name,
                            名稱: this.tw[i].item_name,
                            Item_Class: this.en[i].item_class
                        })
                    }
                    return items || [];
                }
            }

        })
    </script>
</body>

</html>